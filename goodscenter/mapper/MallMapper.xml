<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.zm.goods.bussiness.dao.MallMapper">
	
	<resultMap type="com.zm.goods.pojo.ComponentPage" id="component">
		<id column="id" property="id"/>
		<result column="page_id" property="pageId"/>
		<result column="key" property="key"/>
		<result column="name" property="name"/>
		<result column="sort" property="sort"/>
		<result column="create_time" property="createTime"/>
		<result column="update_time" property="updateTime"/>
		<result column="opt" property="opt"/>
	</resultMap>
	
	<resultMap type="com.zm.goods.pojo.ComponentData" id="componentData">
		<id column="id" property="id"/>
		<result column="cp_id" property="cpId"/>
		<result column="type" property="type"/>
		<result column="picPath" property="picPath"/>
		<result column="description" property="description"/>
		<result column="origin" property="origin"/>
		<result column="price" property="price"/>
		<result column="href" property="href"/>
		<result column="specs" property="specs"/>
		<result column="goods_type" property="goodsType"/>
		<result column="free_post" property="freePost"/>
		<result column="free_tax" property="freeTax"/>
		<result column="popular" property="popular"/>
		<result column="goods_id" property="goodsId"/>
		<result column="sort" property="sort"/>
		<result column="tag_path" property="tagPath"/>
		<result column="enname" property="enname"/>
	</resultMap>
	
	<resultMap type="com.zm.goods.pojo.po.BigSalesGoodsRecord" id="bigSaleRecord">
		<id column="id" property="id"/>
		<result column="item_id" property="itemId"/>
		<result column="new_rebate" property="newRebate"/>
		<result column="new_retail_price" property="newRetailPrice"/>
		<result column="old_rebate" property="oldRebate"/>
		<result column="old_retail_price" property="oldRetailPrice"/>
		<result column="line_price" property="linePrice"/>
		<result column="pic_path" property="picPath"/>
		<result column="year" property="year"/>
		<result column="week" property="week"/>
		<result column="sort" property="sort"/>
		<result column="goods_id" property="goodsId"/>
		<result column="goods_name" property="goodsName"/>
		<result column="start_time" property="startTime"/>
	</resultMap>
	
	<select id="selectComponentForPage" parameterType="Object" resultMap="component">
		SELECT * FROM component_page where page_id = #{pageId} order by sort  
	</select>
	
	<select id="selectComponentDataByPageId" parameterType="Object" resultMap="componentData">
		SELECT * FROM component_data where cp_id = #{pageId} order by cp_id,type,sort  
	</select>
	
	<update id="updateComponentData" parameterType="Object" >
		update Component_data set update_time = now()
		<if test="picPath!=null and picPath!=''">
		,picPath = #{picPath}
		</if>
		<if test="title!=null and title!=''">
		,title = #{title}
		</if>
		<if test="description!=null and description!=''">
		,description = #{description}
		</if>
		<if test="origin!=null and origin!=''">
		,origin = #{origin}
		</if>
		<if test="price!=null and price!=''">
		,price = #{price}
		</if>
		<if test="href!=null and href!=''">
		,href = #{href}
		</if>
		<if test="goodsId!=null and goodsId!=''">
		,goods_id = #{goodsId}
		</if>
		<if test="sort!=null and sort!=''">
		,sort = #{sort}
		</if>
		<if test="tagPath!=null and tagPath!=''">
		,tag_path = #{tagPath}
		</if>
		<if test="enname!=null and enname!=''">
		,enname = #{enname}
		</if>
		where id = #{id} 
	</update>
	
	<select id="selectBigSaleData" parameterType="Object" resultMap="bigSaleRecord">
		SELECT a.*,b.goods_name FROM big_sale_record a left join goods b on a.goods_id= b.goods_id 
		where start_time &gt; CURDATE() order by start_time,sort
	</select>
	
	<insert id="insertBigSaleDataa" parameterType="Object" >
		insert into big_sale_record (item_id, new_rebate, new_retail_price, old_rebate, old_retail_price, 
		line_price, pic_path, year, week, sort, goods_id, start_time, create_time) VALUES 
		<foreach collection="list" item="item" separator=",">
		(#{item.itemId},#{item.newRebate},#{item.newRetailPrice},#{item.oldRebate},#{item.oldRetailPrice},
		#{item.linePrice},#{item.picPath},#{item.year},#{item.week},#{item.sort},#{item.goodsId},#{item.startTime},now())
		</foreach>
	</insert>
	
	<update id="updateBigSaleData" parameterType="Object" >
		<foreach collection="list" item="item" separator=";">
			update big_sale_record 
			<set>
				update_time = now()
				<if test="item.startTime!=null and item.startTime!=''">
				,start_time = #{item.startTime}
				</if>
				<if test="item.newRetailPrice!=null and item.newRetailPrice!=''">
				,new_retail_price = #{item.newRetailPrice}
				</if>
				<if test="item.newRebate!=null and item.newRebate!=''">
				,new_rebate = #{item.newRebate}
				</if>
				<if test="item.linePrice!=null and item.linePrice!=''">
				,line_price = #{item.linePrice}
				</if>
				<if test="item.sort!=null and item.sort!=''">
				,sort = #{item.sort}
				</if>
				<if test="item.week!=null and item.week!=''">
				,week = #{item.week}
				</if>
				<if test="item.year!=null and item.year!=''">
				,year = #{item.year}
				</if>
			</set>
			where id = #{item.id}
		</foreach>
	</update>
	
</mapper>